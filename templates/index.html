<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omar's Dashboard - Your Personal Growth Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* New Font: Poppins */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fa; /* Light gray background */
            color: #2c3e50; /* Dark text */
            transition: background-color 0.6s ease, color 0.6s ease;
            overflow-x: hidden;
        }

        /* Dark Mode */
        .dark body {
            background-color: #1a202c; /* Dark charcoal */
            color: #e2e8f0; /* Light gray text */
        }

        .container {
            max-width: 1500px; /* Wider container */
            margin: 0 auto;
            padding: 2rem;
        }

        /* Sidebar */
        .sidebar {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1); /* Softer, deeper shadow */
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Ease-out quad */
            padding: 2rem 1.5rem;
            flex-shrink: 0;
            width: 280px;
            position: relative;
            z-index: 20;
            display: flex;
            flex-direction: column;
        }
        .dark .sidebar {
            background-color: #2d3748; /* Darker blue-gray */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }
        .sidebar.collapsed {
            width: 80px;
            padding: 1.5rem 0.5rem;
        }
        .sidebar.collapsed .nav-item-text,
        .sidebar.collapsed .sidebar-header h1,
        .sidebar.collapsed #darkModeToggle {
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            white-space: nowrap;
        }
        .sidebar.collapsed .nav-link {
            justify-content: center; /* Center icons when collapsed */
            padding: 1rem 0;
        }
        .sidebar.collapsed .nav-link svg {
            margin-right: 0 !important;
        }
        .sidebar-toggle-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background-color: #3b82f6; /* Blue */
            color: white;
            border-radius: 50%;
            width: 40px; /* Larger toggle */
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            transition: all 0.3s ease;
            z-index: 10;
        }
        .sidebar.collapsed .sidebar-toggle-btn {
            right: 20px;
        }
        .sidebar-toggle-btn:hover {
            background-color: #2563eb;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 18px rgba(59, 130, 246, 0.6);
        }
        .sidebar-header {
            text-align: center;
            margin-bottom: 3rem;
            transition: opacity 0.3s ease;
        }
        .sidebar.collapsed .sidebar-header {
            margin-bottom: 1rem;
        }
        .sidebar-header h1 {
            font-size: 2.5rem; /* Larger, bolder title */
            font-weight: 800;
            color: #3b82f6;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        .dark .sidebar-header h1 {
            color: #60a5fa;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 1.2rem 1.5rem; /* Generous padding */
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.3s ease-in-out;
            position: relative;
            overflow: hidden;
        }
        .dark .nav-link {
            color: #cbd5e0;
        }
        .nav-link:hover {
            background-color: #edf2f7; /* Lighter hover */
            transform: translateX(10px); /* More pronounced slide */
            color: #2d3748;
        }
        .dark .nav-link:hover {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        .nav-link.active {
            background-color: #3b82f6; /* Primary blue */
            color: #ffffff;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
            transform: translateX(0);
        }
        .nav-link.active svg {
            fill: #ffffff;
        }
        .nav-link svg {
            margin-right: 1.2rem;
            transition: margin-right 0.3s ease;
        }
        /* Ripple effect */
        .nav-link::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            opacity: 0;
            transform: scale(1) translate(-50%, -50%);
            transition: all 0.4s ease-out;
        }
        .nav-link:active::after {
            width: 200%;
            height: 200%;
            opacity: 1;
            transition: 0s;
        }


        .content-area-wrapper {
            flex-grow: 1;
            transition: margin-left 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .content-section {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
            min-height: 80vh;
            transition: background-color 0.6s ease, box-shadow 0.6s ease;
            animation: slideInFromTop 0.8s ease-out; /* New animation */
        }
        .dark .content-section {
            background-color: #2d3748;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .card {
            background-color: #fefefe; /* Brighter card background */
            border-radius: 1.25rem; /* More rounded */
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08); /* Stronger, softer shadow */
            transition: background-color 0.4s ease, box-shadow 0.4s ease, transform 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid #e0e0e0; /* Subtle border */
        }
        .dark .card {
            background-color: #3a4759; /* Darker, richer card background */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: #4a5568;
        }
        .card:hover {
            transform: translateY(-8px); /* More lift on hover */
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
        }
        .dark .card:hover {
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.6);
        }
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0) 100%);
            border-radius: 1.25rem;
            z-index: 0;
        }
        .dark .card::before {
            background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0) 100%);
        }
        .card > * {
            position: relative;
            z-index: 1;
        }


        input[type="text"], input[type="date"], input[type="number"], input[type="url"], textarea, select {
            padding: 1.1rem; /* More padding */
            border-radius: 0.8rem; /* More rounded */
            border: 1px solid #d1d5db; /* Lighter border */
            font-size: 1.05rem;
            background-color: #f9fafb; /* Off-white input */
            color: #2c3e50;
            transition: all 0.3s ease;
        }
        .dark input[type="text"], .dark input[type="date"], .dark input[type="number"], .dark input[type="url"], .dark textarea, .dark select {
            background-color: #4a5568;
            color: #e2e8f0;
            border-color: #6b7280;
        }
        input[type="text"]:focus, input[type="date"]:focus, input[type="number"]:focus, input[type="url"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3b82f6; /* Blue highlight */
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }
        .dark input[type="text"]:focus, .dark input[type="date"]:focus, .dark input[type="number"]:focus, .dark input[type="url"]:focus, .dark textarea:focus, .dark select:focus {
            box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.3);
        }

        button {
            background-color: #3b82f6; /* Primary blue */
            color: white;
            padding: 1.1rem 2.2rem; /* More padding */
            border-radius: 0.8rem;
            font-weight: 600;
            transition: all 0.25s ease-in-out;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        button:hover {
            background-color: #2563eb;
            transform: translateY(-4px); /* More lift */
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        .delete-btn {
            background-color: #ef4444; /* Red */
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }
        .delete-btn:hover {
            background-color: #dc2626;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.6);
        }
        .add-btn {
            background-color: #10b981; /* Green */
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }
        .add-btn:hover {
            background-color: #059669;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.6);
        }
        .secondary-btn {
            background-color: #6b7280; /* Gray */
            box-shadow: 0 5px 15px rgba(107, 114, 128, 0.4);
        }
        .secondary-btn:hover {
            background-color: #4b5563;
            box-shadow: 0 8px 25px rgba(107, 114, 128, 0.6);
        }

        /* Modal styles */
        .modal {
            background-color: rgba(0,0,0,0.85); /* Darker, more opaque overlay */
        }
        .modal-content {
            padding: 40px; /* More padding */
            border-radius: 1.5rem; /* More rounded */
            max-width: 650px; /* Wider modal */
            box-shadow: 0 20px 60px rgba(0,0,0,0.9); /* Stronger shadow */
        }
        .dark .modal-content {
            background-color: #212121;
            color: #e0e0e0;
        }
        .close-button {
            color: #bbb;
            font-size: 40px; /* Even larger */
        }
        .close-button:hover, .close-button:focus {
            color: #3b82f6;
        }
        .dark .close-button:hover, .dark .close-button:focus {
            color: #60a5fa;
        }

        /* Status indicators */
        .status-completed {
            color: #16a34a; /* Green */
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .dark .status-completed {
            color: #34d399;
        }
        .status-pending {
            color: #dc2626; /* Red */
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .dark .status-pending {
            color: #f87171;
        }

        /* Pomodoro Timer */
        .pomodoro-timer {
            padding: 3rem; /* More padding */
            border-radius: 1.5rem; /* More rounded */
            background: linear-gradient(145deg, #e3f2fd, #bbdefb); /* Soft gradient */
            color: #000;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .dark .pomodoro-timer {
            background: linear-gradient(145deg, #2c3e50, #4a6886); /* Dark gradient */
            color: #fff;
        }
        .timer-display {
            font-size: 6.5rem; /* Even larger */
            font-weight: 900;
            margin-bottom: 2.5rem;
            color: #1a73e8;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
        }
        .dark .timer-display {
            color: #64b5f6;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
        }
        .timer-buttons button {
            margin: 0.9rem;
            min-width: 140px;
            font-size: 1.2rem;
        }
        .timer-config input {
            width: 110px;
            padding: 0.8rem;
            font-size: 1.15rem;
            border: 2px solid #3b82f6;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        .dark .timer-config input {
            border-color: #60a5fa;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }

        /* Table styles */
        .data-table-container {
            margin-top: 2.5rem;
            border-radius: 1.25rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden; /* Ensures rounded corners */
        }
        .dark .data-table-container {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            text-align: left;
        }
        .data-table th, .data-table td {
            padding: 1.3rem 1.8rem; /* Even more padding */
            vertical-align: middle;
            border-bottom: 1px solid #e9ecef; /* Slightly darker separator */
        }
        .dark .data-table th, .dark .data-table td {
            border-bottom: 1px solid #4a5568;
        }
        .data-table th {
            background-color: #f8f9fa; /* Very light header */
            font-weight: 700;
            color: #495057;
            text-transform: uppercase;
            font-size: 0.95rem;
            letter-spacing: 0.1em;
        }
        .dark .data-table th {
            background-color: #3a4759;
            color: #cbd5e0;
        }
        .data-table tbody tr {
            background-color: #ffffff;
            transition: all 0.3s ease-in-out;
        }
        .dark .data-table tbody tr {
            background-color: #2d3748;
        }
        .data-table tbody tr:hover {
            background-color: #f0f4f7;
            transform: scale(1.005); /* Subtle zoom */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        .dark .data-table tbody tr:hover {
            background-color: #3a4759;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .data-table tbody tr:last-child td {
            border-bottom: none;
        }
        /* Rounded corners for table */
        .data-table thead tr:first-child th:first-child { border-top-left-radius: 1.25rem; }
        .data-table thead tr:first-child th:last-child { border-top-right-radius: 1.25rem; }
        .data-table tbody tr:last-child td:first-child { border-bottom-left-radius: 1.25rem; }
        .data-table tbody tr:last-child td:last-child { border-bottom-right-radius: 1.25rem; }

        /* Animations */
        @keyframes slideInFromTop {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* Chart container height */
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container flex flex-col lg:flex-row gap-8 py-8">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-toggle-btn" onclick="toggleSidebar()">
                <svg id="sidebar-toggle-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
            </div>
            <div class="sidebar-header">
                <h1 class="text-3xl font-extrabold text-center">
                    Growth Hub
                </h1>
            </div>
            <button id="darkModeToggle" class="w-full py-3 px-4 mb-6 rounded-lg bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-200 font-semibold transition-colors duration-300 shadow-md hover:shadow-lg">
                Toggle Dark Mode
            </button>
            <nav class="flex-grow">
                <ul>
                    <li>
                        <a href="#home" class="nav-link active" data-section="home">
                            <svg class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m0 0l-7 7m7-7v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                            <span class="nav-item-text">Dashboard Overview</span>
                        </a>
                    </li>
                    <li>
                        <a href="#wellness" class="nav-link" data-section="wellness">
                            <svg class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M16.364 16.364l.707.707M12 21v-1m-6.364-1.636l-.707-.707M3 12H4M4.636 7.636l.707-.707M6 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                            <span class="nav-item-text">Wellness & Mood</span>
                        </a>
                    </li>
                    <li>
                        <a href="#medical" class="nav-link" data-section="medical">
                            <svg class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="nav-item-text">Medical Student Hub</span>
                        </a>
                    </li>
                    <li>
                        <a href="#fitness" class="nav-link" data-section="fitness">
                            <svg class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            <span class="nav-item-text">Fitness & Gym Tracker</span>
                        </a>
                    </li>
                    <li>
                        <a href="#basketball" class="nav-link" data-section="basketball">
                            <svg class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l-2 2m2-2l2 2m-2-2v12h5l2-2V6m0 0H9m11 0h-4M4 18v-7a4 4 0 014-4h8a4 4 0 014 4v7"></path></svg>
                            <span class="nav-item-text">Basketball Analysis</span>
                        </a>
                    </li>
                    <li>
                        <a href="#self-development" class="nav-link" data-section="self-development">
                            <svg class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18s-3.332.477-4.5 1.253"></path></svg>
                            <span class="nav-item-text">Skill & Courses</span>
                        </a>
                    </li>
                    <li>
                        <a href="#streaks-checkpoints" class="nav-link" data-section="streaks-checkpoints">
                            <svg class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="nav-item-text">Streaks & Checkpoints</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <div id="main-content" class="content-area-wrapper">
            <main class="content-section">
                <!-- Home Section -->
                <section id="home" class="dashboard-section">
                    <h2 class="text-4xl font-extrabold text-gray-800 dark:text-gray-100 mb-8">
                        Hello, Omar! 👋 Your Daily Overview.
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Today's Focus & Progress Card -->
                        <div class="card col-span-full">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Today's Focus & Progress 🎯</h3>
                            <div id="today-summary" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 dark:text-gray-300">
                                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow-inner">
                                    <h4 class="font-semibold text-lg mb-2">Today's Schedule:</h4>
                                    <ul id="today-schedule-list" class="list-disc list-inside">
                                        <li>Loading...</li>
                                    </ul>
                                </div>
                                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow-inner">
                                    <h4 class="font-semibold text-lg mb-2">Overall Progress:</h4>
                                    <ul id="overall-progress-summary" class="list-disc list-inside">
                                        <li>Pomodoro Hours (This Week): <span id="summary-pomodoro-hours">0</span></li>
                                        <li>Lectures Completed (Total): <span id="summary-lectures-completed">0</span></li>
                                        <li>Workouts Logged (This Week): <span id="summary-workouts-logged">0</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Completed Today Card (NEW) -->
                        <div class="card col-span-full">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Completed Today 🎉</h3>
                            <div class="data-table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Time</th>
                                            <th>Activity</th>
                                            <th>Type</th>
                                        </tr>
                                    </thead>
                                    <tbody id="completed-today-list">
                                        <tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No completions yet today. Keep going!</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Shortcuts Card -->
                        <div class="card col-span-full">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Quick Actions ⚡</h3>
                            <div class="flex flex-wrap gap-4 justify-center">
                                <button class="bg-purple-600 hover:bg-purple-700 text-white py-3 px-6 rounded-lg shadow-md hover:shadow-lg">Launch Study Timer</button>
                                <button class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg shadow-md hover:shadow-lg">Add Game Clip</button>
                                <button class="bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-lg shadow-md hover:shadow-lg">Mark Workout Done</button>
                                <button class="bg-red-600 hover:bg-red-700 text-white py-3 px-6 rounded-lg shadow-md hover:shadow-lg">Record Mood</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Wellness & Mood Section (NEW) -->
                <section id="wellness" class="dashboard-section hidden">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6">Wellness & Mood ✨</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Mood Tracker Card -->
                        <div class="card">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Mood Tracker 😃</h3>
                            <div class="data-table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Mood</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="mood-list">
                                        <tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400">Loading moods...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4">
                                <input type="date" id="mood-date" class="mb-2">
                                <input type="number" id="mood-level" placeholder="Mood Level (1-5)" min="1" max="5" class="mb-2">
                                <textarea id="mood-notes" placeholder="Notes..." rows="2"></textarea>
                                <button onclick="addMood()" class="add-btn w-full">Add Mood</button>
                            </div>
                        </div>

                        <!-- Sleep Tracker Card -->
                        <div class="card">
                            <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Sleep Tracker 😴</h3>
                            <div class="data-table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Hours</th>
                                            <th>Quality</th>
                                    </tr>
                                </thead>
                                <tbody id="sleep-list">
                                    <tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400">Loading sleep data...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="date" id="sleep-date" class="mb-2">
                            <input type="number" id="hours-slept" placeholder="Hours Slept" step="0.1" class="mb-2">
                            <input type="number" id="sleep-quality" placeholder="Quality (1-5)" min="1" max="5" class="mb-2">
                            <button onclick="addSleep()" class="add-btn w-full">Add Sleep</button>
                        </div>
                    </div>
                </section>

                <!-- Medical Student Hub Section -->
                <section id="medical" class="dashboard-section hidden">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6">Medical Student Hub 🩺</h2>
                    
                    <!-- Pomodoro Timer Card - Moved Here -->
                    <div class="card mb-6">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Pomodoro Timer ⏰</h3>
                        <div class="pomodoro-timer">
                            <p class="text-xl font-semibold mb-3" id="timer-status">Work Time!</p>
                            <div class="timer-display" id="timer-display">25:00</div>
                            <div class="timer-buttons flex justify-center flex-wrap gap-3 mb-4">
                                <button onclick="startTimer()" class="add-btn">Start</button>
                                <button onclick="pauseTimer()" class="bg-yellow-600 hover:bg-yellow-700">Pause</button>
                                <button onclick="resetTimer()" class="delete-btn">Reset</button>
                            </div>
                            <div class="timer-config text-gray-700 dark:text-gray-300 flex justify-center items-center flex-wrap gap-4">
                                <label class="flex flex-col items-center">Work (min): <input type="number" id="work-minutes" value="25" min="1" max="60"></label>
                                <label class="flex flex-col items-center">Break (min): <input type="number" id="break-minutes" value="5" min="1" max="30"></label>
                            </div>
                        </div>
                    </div>

                    <!-- Study Plan Tab -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Daily Study Plan 📚</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Time</th>
                                        <th>Topic</th>
                                        <th>Resource</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="study-plan-list">
                                    <tr><td colspan="6" class="text-center text-gray-500 dark:text-gray-400">Loading study plans...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="study-day" placeholder="Day (e.g., Monday)">
                            <input type="text" id="study-time" placeholder="Time Slot (e.g., 9-11 AM)">
                            <input type="text" id="study-topic" placeholder="Topic">
                            <input type="text" id="study-resource" placeholder="Resource (Anki, Lecturio, AMBOSS)">
                            <button onclick="addStudyPlan()" class="add-btn w-full">Add Study Plan</button>
                        </div>
                    </div>

                    <!-- Subjects Tracker -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Subjects Tracker 🧠</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Subject Name</th>
                                        <th>Lectures Done</th>
                                        <th>Total Lectures</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="subjects-list">
                                    <tr><td colspan="5" class="text-center text-gray-500 dark:text-gray-400">Loading subjects...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="subject-name" placeholder="Subject Name">
                            <input type="number" id="subject-total-lectures" placeholder="Total Lectures" min="0">
                            <textarea id="subject-description" placeholder="Description" rows="2"></textarea>
                            <button onclick="addSubject()" class="add-btn w-full">Add Subject</button>
                        </div>
                    </div>

                    <!-- To-Read/Watch Queue -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">To-Read/Watch Queue 📺📖</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Type</th>
                                        <th>Link</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="read-watch-list">
                                    <tr><td colspan="4" class="text-center text-gray-500 dark:text-gray-400">Loading queue...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="queue-title" placeholder="Title">
                            <select id="queue-type" class="mb-2">
                                <option value="">Select Type</option>
                                <option value="Video">Video</option>
                                <option value="PDF">PDF</option>
                                <option value="Lecture">Lecture</option>
                            </select>
                            <input type="url" id="queue-url" placeholder="URL">
                            <label class="flex items-center mb-2 text-gray-700 dark:text-gray-300">
                                <input type="checkbox" id="queue-completed" class="mr-2"> Completed
                            </label>
                            <button onclick="addReadWatchQueue()" class="add-btn w-full">Add to Queue</button>
                        </div>
                    </div>

                    <!-- Progress Chart -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Study Progress Chart 📈</h3>
                        <div class="chart-container"> <!-- Added container for fixed height -->
                            <canvas id="studyProgressChart"></canvas>
                        </div>
                        <div class="mt-4">
                            <input type="date" id="chart-week-start-date" class="mb-2">
                            <input type="number" id="chart-hours-studied" placeholder="Hours Studied">
                            <textarea id="chart-topics-covered" placeholder="Topics Covered" rows="2"></textarea>
                            <button onclick="addProgressChartData()" class="add-btn w-full">Add Progress Data</button>
                        </div>
                    </div>
                </section>

                <!-- Fitness & Gym Tracker Section -->
                <section id="fitness" class="dashboard-section hidden">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6">Fitness & Gym Tracker 💪</h2>
                    
                    <!-- Workout Plan Tab -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Workout Plan 🏋️</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Split</th>
                                        <th>Exercise</th>
                                        <th>Sets</th>
                                        <th>Reps</th>
                                        <th>Weight</th>
                                        <th>Soreness</th>
                                        <th>Notes</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="workout-list">
                                    <tr><td colspan="9" class="text-center text-gray-500 dark:text-gray-400">Loading workouts...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="date" id="workout-date" class="mb-2">
                            <select id="workout-split" class="mb-2">
                                <option value="">Select Split</option>
                                <option value="Push">Push</option>
                                <option value="Pull">Pull</option>
                                <option value="Legs">Legs</option>
                                <option value="Cardio">Cardio</option>
                                <option value="Mobility">Mobility</option>
                            </select>
                            <input type="text" id="exercise-name" placeholder="Exercise Name">
                            <input type="number" id="exercise-sets" placeholder="Sets">
                            <input type="number" id="exercise-reps" placeholder="Reps">
                            <input type="number" id="exercise-weight" placeholder="Weight (kg/lbs)">
                            <input type="number" id="muscle-soreness" placeholder="Muscle Soreness (1-5)" min="1" max="5">
                            <textarea id="workout-notes" placeholder="Notes..." rows="2"></textarea>
                            <button onclick="addWorkout()" class="add-btn w-full">Add Workout</button>
                        </div>
                    </div>

                    <!-- Body Progress Tracker -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Body Progress Tracker 📊</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Weight (kg/lbs)</th>
                                        <th>Measurements</th>
                                        <th>Goal</th>
                                        <th>Photo</th>
                                    </tr>
                                </thead>
                                <tbody id="body-progress-list">
                                    <tr><td colspan="5" class="text-center text-gray-500 dark:text-gray-400">Loading body progress...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="date" id="body-record-date" class="mb-2">
                            <input type="number" id="body-weight" placeholder="Weight (kg/lbs)" step="0.1">
                            <input type="url" id="body-photo-url" placeholder="Photo URL">
                            <textarea id="body-measurements" placeholder='Measurements (e.g., {"chest": "40", "waist": "32"})' rows="2"></textarea>
                            <input type="text" id="body-goal" placeholder="Goal (e.g., get shredded in 4 months)">
                            <button onclick="addBodyProgress()" class="add-btn w-full">Add Body Progress</button>
                        </div>
                    </div>

                    <!-- Nutrition Tab -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Nutrition Log 🍎</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Meal Type</th>
                                        <th>Description</th>
                                        <th>Calories</th>
                                        <th>Protein (g)</th>
                                    </tr>
                                </thead>
                                <tbody id="nutrition-list">
                                    <tr><td colspan="5" class="text-center text-gray-500 dark:text-gray-400">Loading nutrition data...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="date" id="meal-date" class="mb-2">
                            <select id="meal-type" class="mb-2">
                                <option value="">Select Meal Type</option>
                                <option value="Breakfast">Breakfast</option>
                                <option value="Lunch">Lunch</option>
                                <option value="Dinner">Dinner</option>
                                <option value="Snack">Snack</option>
                            </select>
                            <textarea id="meal-description" placeholder="Meal Description" rows="2"></textarea>
                            <input type="number" id="meal-calories" placeholder="Calories">
                            <input type="number" id="meal-protein" placeholder="Protein Intake (g)" step="0.1">
                            <button onclick="addNutrition()" class="add-btn w-full">Add Meal</button>
                        </div>
                    </div>

                    <!-- Weekly Shopping List -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Shopping List 🛒</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Quantity</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="shopping-list-items">
                                    <tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400">Loading shopping list...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="shopping-item-name" placeholder="Item Name">
                            <input type="text" id="shopping-item-quantity" placeholder="Quantity (e.g., 1kg, 6 eggs)">
                            <label class="flex items-center mb-2 text-gray-700 dark:text-gray-300">
                                <input type="checkbox" id="shopping-item-purchased" class="mr-2"> Purchased
                            </label>
                            <button onclick="addShoppingItem()" class="add-btn w-full">Add Item to List</button>
                        </div>
                    </div>
                </section>

                <!-- Basketball & Analysis Lab Section -->
                <section id="basketball" class="dashboard-section hidden">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6">Basketball Analysis Lab 🏀</h2>
                    
                    <!-- Video Analysis Board -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Video Analysis Board 🎥</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Upload Date</th>
                                        <th>Annotations</th>
                                        <th>Link</th>
                                    </tr>
                                </thead>
                                <tbody id="game-clips-list">
                                    <tr><td colspan="4" class="text-center text-gray-500 dark:text-gray-400">Loading game clips...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="clip-title" placeholder="Clip Title">
                            <input type="url" id="clip-video-url" placeholder="Video URL">
                            <textarea id="clip-annotations" placeholder='Annotations (e.g., {"time": "0:15", "note": "Good screen"})' rows="3"></textarea>
                            <button onclick="addGameClip()" class="add-btn w-full">Add Game Clip</button>
                        </div>
                    </div>

                    <!-- Scouting Templates -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Scouting Templates 📝</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Template Name</th>
                                        <th>Opponent</th>
                                        <th>Report Content</th>
                                    </tr>
                                </thead>
                                <tbody id="scouting-templates-list">
                                    <tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400">Loading scouting templates...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="template-name" placeholder="Template Name">
                            <input type="text" id="opponent-name" placeholder="Opponent Name">
                            <textarea id="report-content" placeholder="Report Content" rows="3"></textarea>
                            <button onclick="addScoutingTemplate()" class="add-btn w-full">Add Scouting Template</button>
                        </div>
                    </div>

                    <!-- Learning Tab -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Learning Resources 🎓</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Platform</th>
                                        <th>Link</th>
                                    </tr>
                                </thead>
                                <tbody id="learning-resources-list">
                                    <tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400">Loading learning resources...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="resource-title" placeholder="Resource Title">
                            <input type="text" id="resource-platform" placeholder="Platform (YouTube, Coursera)">
                            <input type="url" id="resource-url" placeholder="URL">
                            <button onclick="addLearningResource()" class="add-btn w-full">Add Learning Resource</button>
                        </div>
                    </div>
                </section>

                <!-- Self-Development & Courses Section -->
                <section id="self-development" class="dashboard-section hidden">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6">Skill & Courses Progression 🌟</h2>
                    
                    <!-- Courses Tracker -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Courses Tracker 📈</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Course Name</th>
                                        <th>Status</th>
                                        <th>Start Date</th>
                                        <th>Completion Date</th>
                                    </tr>
                                </thead>
                                <tbody id="courses-list">
                                    <tr><td colspan="4" class="text-center text-gray-500 dark:text-gray-400">Loading courses...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="course-name" placeholder="Course Name">
                            <select id="course-status" class="mb-2">
                                <option value="">Select Status</option>
                                <option value="Not started">Not started</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                            </select>
                            <input type="date" id="course-start-date" class="mb-2">
                            <input type="date" id="course-completion-date" class="mb-2">
                            <button onclick="addCourse()" class="add-btn w-full">Add Course</button>
                        </div>
                    </div>

                    <!-- Skill Goals -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Skill Goals 🎯</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Skill Name</th>
                                        <th>Target Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="skill-goals-list">
                                    <tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400">Loading skill goals...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="skill-name" placeholder="Skill Name (e.g., Learn Python)">
                            <input type="date" id="skill-target-date" class="mb-2">
                            <label class="flex items-center mb-2 text-gray-700 dark:text-gray-300">
                                <input type="checkbox" id="skill-achieved" class="mr-2"> Achieved
                            </label>
                            <button onclick="addSkillGoal()" class="add-btn w-full">Add Skill Goal</button>
                        </div>
                    </div>
                </section>

                <!-- Streaks & Checkpoints Section (NEW) -->
                <section id="streaks-checkpoints" class="dashboard-section hidden">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6">Streaks & Checkpoints ✅🔥</h2>
                    
                    <!-- Achievements Card - Moved Here -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Achievements 🏆</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody id="achievements-list">
                                    <tr><td colspan="2" class="text-center text-gray-500 dark:text-gray-400 py-4">No achievements yet.</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="date" id="achievement-date" class="mb-2">
                            <textarea id="achievement-description" placeholder="Achievement description..." rows="2"></textarea>
                            <button onclick="addAchievement()" class="add-btn w-full">Add Achievement</button>
                        </div>
                    </div>

                    <!-- Daily Schedule & Routine -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Daily Schedule & Routine 📅</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Morning Routine Completed</th>
                                    </tr>
                                </thead>
                                <tbody id="daily-schedule-list">
                                    <tr><td colspan="2" class="text-center text-gray-500 dark:text-gray-400 py-4">Loading daily schedule...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="date" id="schedule-date" class="mb-2">
                            <label class="flex items-center mb-2 text-gray-700 dark:text-gray-300">
                                <input type="checkbox" id="morning-routine-completed" class="mr-2"> Morning Routine Completed
                            </label>
                            <button onclick="addDailySchedule()" class="add-btn w-full">Add Daily Schedule</button>
                        </div>
                    </div>

                    <!-- Time-Blocking Plan -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Time-Blocking Plan ⏳</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Time Slot</th>
                                        <th>Activity</th>
                                    </tr>
                                </thead>
                                <tbody id="time-blocking-list">
                                    <tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No time blocks added yet.</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="date" id="time-block-date" class="mb-2">
                            <input type="text" id="time-block-slot" placeholder="Time Slot (e.g., 9-11 AM)">
                            <input type="text" id="time-block-activity" placeholder="Activity (e.g., Study Anatomy)">
                            <button onclick="addTimeBlock()" class="add-btn w-full">Add Time Block</button>
                        </div>
                    </div>

                    <!-- Consistency Score -->
                    <div class="card">
                        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Consistency Score ✅</h3>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Sleep Score</th>
                                        <th>Gym Score</th>
                                        <th>Study Score</th>
                                    </tr>
                                </thead>
                                <tbody id="consistency-score-list">
                                    <tr><td colspan="4" class="text-center text-gray-500 dark:text-gray-400 py-4">No consistency scores yet.</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <input type="date" id="consistency-date" class="mb-2">
                            <input type="number" id="consistency-sleep" placeholder="Sleep Score (1-10)" min="1" max="10">
                            <input type="number" id="consistency-gym" placeholder="Gym Score (1-10)" min="1" max="10">
                            <input type="number" id="consistency-study" placeholder="Study Score (1-10)" min="1" max="10">
                            <button onclick="addConsistencyScore()" class="add-btn w-full">Add Consistency Score</button>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Message Box Modal -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeMessageModal()">&times;</span>
            <p id="messageText" class="text-lg text-center"></p>
        </div>
    </div>

    <audio id="timer-beep" src="https://www.soundjay.com/buttons/beep-07.wav" preload="auto"></audio>


    <script>
        // --- Dark Mode Toggle ---
        const darkModeToggle = document.getElementById('darkModeToggle');
        const htmlElement = document.documentElement;

        // Check for saved theme preference or system preference
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');

        function setDarkMode(isDark) {
            if (isDark) {
                htmlElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                darkModeToggle.textContent = 'Light Mode';
            } else {
                htmlElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                darkModeToggle.textContent = 'Dark Mode';
            }
            // Re-render chart to update colors if chart is visible
            if (document.getElementById('medical').classList.contains('dashboard-section')) {
                loadProgressCharts();
            }
        }

        // Initialize theme on load
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            setDarkMode(savedTheme === 'dark');
        } else {
            setDarkMode(prefersDark.matches); // Use system preference
        }

        // Listen for system theme changes
        prefersDark.addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) { // Only react if no explicit preference is set
                setDarkMode(e.matches);
            }
        });

        darkModeToggle.addEventListener('click', () => {
            setDarkMode(!htmlElement.classList.contains('dark'));
        });

        // --- Sidebar Toggle ---
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const sidebarToggleIcon = document.getElementById('sidebar-toggle-icon');
        let isSidebarCollapsed = false;

        function toggleSidebar() {
            isSidebarCollapsed = !isSidebarCollapsed;
            if (isSidebarCollapsed) {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('lg:ml-20'); // Adjust margin for collapsed sidebar
                sidebarToggleIcon.innerHTML = `<path fill-rule="evenodd" d="M4 6h16V4H4zm0 5h16v-2H4zm0 5h16v-2H4z" clip-rule="evenodd"></path>`; // Hamburger icon
            } else {
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('lg:ml-20');
                sidebarToggleIcon.innerHTML = `<path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"></path>`; // Close icon
            }
        }


        // --- Utility Functions ---
        function showMessage(message, type = 'info') {
            const messageModal = document.getElementById('messageModal');
            const messageText = document.getElementById('messageText');
            messageText.textContent = message;
            if (type === 'error') {
                messageText.style.color = 'red';
            } else if (type === 'success') {
                messageText.style.color = 'green';
            } else {
                messageText.style.color = 'black';
            }
            messageModal.style.display = 'flex';
        }

        function closeMessageModal() {
            document.getElementById('messageModal').style.display = 'none';
        }

        async function fetchData(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Fetch error:', error);
                showMessage(`Error fetching data: ${error.message}`, 'error');
                return null;
            }
        }

        async function postData(url, data) {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Post error:', error);
                showMessage(`Error adding data: ${error.message}`, 'error');
                return null;
            }
        }

        async function putData(url, data) {
            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('PUT error:', error);
                showMessage(`Error updating data: ${error.message}`, 'error');
                return null;
            }
        }

        async function deleteData(url) {
            try {
                const response = await fetch(url, {
                    method: 'DELETE'
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Delete error:', error);
                showMessage(`Error deleting data: ${error.message}`, 'error');
                return null;
            }
        }

        // --- Navigation Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.dashboard-section');

            function showSection(sectionId) {
                sections.forEach(section => {
                    section.classList.add('hidden');
                });
                document.getElementById(sectionId).classList.remove('hidden');

                navLinks.forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`.nav-link[data-section="${sectionId}"]`).classList.add('active');
                
                // Load data for the active section
                loadSectionData(sectionId);
            }

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = e.currentTarget.dataset.section;
                    history.pushState(null, '', `#${sectionId}`);
                    showSection(sectionId);
                });
            });

            // Handle initial load and hash changes
            const initialHash = window.location.hash.substring(1) || 'home';
            showSection(initialHash);

            window.addEventListener('hashchange', () => {
                const newHash = window.location.hash.substring(1) || 'home';
                showSection(newHash);
            });
        });

        // --- Data Loading Functions for Each Section ---
        async function loadSectionData(sectionId) {
            switch (sectionId) {
                case 'home':
                    await loadTodaySummary(); // New summary data for home
                    await loadCompletedToday(); // Load completed items for the new section
                    break;
                case 'wellness': // New wellness section
                    await loadMoods();
                    await loadSleepData();
                    break;
                case 'medical':
                    await loadStudyPlans();
                    await loadSubjects();
                    await loadReadWatchQueue();
                    await loadProgressCharts();
                    break;
                case 'fitness':
                    await loadWorkouts();
                    await loadBodyProgress();
                    await loadNutrition();
                    await loadShoppingList();
                    break;
                case 'basketball':
                    await loadGameClips();
                    await loadScoutingTemplates();
                    await loadLearningResources();
                    break;
                case 'self-development':
                    await loadCourses();
                    await loadSkillGoals();
                    break;
                case 'streaks-checkpoints': // New streaks section
                    await loadDailySchedule();
                    await loadTimeBlocking();
                    await loadConsistencyScore();
                    await loadAchievements(); // Achievements also moved here for consistency
                    break;
                default:
                    break;
            }
        }

        // --- Home Section Functions ---
        async function loadTodaySummary() {
            const summaryData = await fetchData('/api/today_summary');
            const todayScheduleList = document.getElementById('today-schedule-list');
            const summaryPomodoroHours = document.getElementById('summary-pomodoro-hours');
            const summaryLecturesCompleted = document.getElementById('summary-lectures-completed');
            const summaryWorkoutsLogged = document.getElementById('summary-workouts-logged');

            todayScheduleList.innerHTML = '';
            if (summaryData && summaryData.today_schedule && summaryData.today_schedule.length > 0) {
                summaryData.today_schedule.forEach(item => {
                    todayScheduleList.innerHTML += `<li>${item.time_slot ? item.time_slot + ': ' : ''}${item.activity || item.topic}</li>`;
                });
            } else {
                todayScheduleList.innerHTML = '<li>No specific plans for today! 🎉</li>';
            }

            if (summaryData && summaryData.overall_progress) {
                summaryPomodoroHours.textContent = summaryData.overall_progress.pomodoro_hours_this_week.toFixed(1);
                summaryLecturesCompleted.textContent = summaryData.overall_progress.total_lectures_completed;
                summaryWorkoutsLogged.textContent = summaryData.overall_progress.workouts_this_week;
            } else {
                summaryPomodoroHours.textContent = 'N/A';
                summaryLecturesCompleted.textContent = 'N/A';
                summaryWorkoutsLogged.textContent = 'N/A';
            }
        }

        async function loadCompletedToday() {
            const completedData = await fetchData('/api/completed_today');
            const completedTodayListTbody = document.getElementById('completed-today-list');
            completedTodayListTbody.innerHTML = '';

            if (completedData && completedData.length > 0) {
                completedData.forEach(item => {
                    completedTodayListTbody.innerHTML += `
                        <tr>
                            <td>${item.time_slot || 'N/A'}</td>
                            <td>${item.activity || item.topic || item.exercise_name || item.subject_name}</td>
                            <td>${item.type}</td>
                        </tr>
                    `;
                });
            } else {
                completedTodayListTbody.innerHTML = `<tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No completions yet today. Keep going!</td></tr>`;
            }
        }


        // --- Wellness & Mood Section Functions ---
        async function loadMoods() {
            const moods = await fetchData('/api/mood_tracker');
            const moodListTbody = document.getElementById('mood-list');
            moodListTbody.innerHTML = ''; // Clear existing content
            if (moods && moods.length > 0) {
                moods.forEach(mood => {
                    moodListTbody.innerHTML += `
                        <tr>
                            <td>${mood.record_date}</td>
                            <td>${mood.mood_level}</td>
                            <td>${mood.notes || 'N/A'}</td>
                        </tr>
                    `;
                });
            } else {
                moodListTbody.innerHTML = `<tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No mood entries yet.</td></tr>`;
            }
        }

        async function addMood() {
            const recordDate = document.getElementById('mood-date').value;
            const moodLevel = document.getElementById('mood-level').value;
            const notes = document.getElementById('mood-notes').value;

            if (!recordDate || !moodLevel) {
                showMessage('Please fill in date and mood level.', 'error');
                return;
            }

            const data = { record_date: recordDate, mood_level: parseInt(moodLevel), notes: notes };
            const result = await postData('/api/mood_tracker', data);
            if (result) {
                showMessage('Mood added successfully!', 'success');
                document.getElementById('mood-date').value = '';
                document.getElementById('mood-level').value = '';
                document.getElementById('mood-notes').value = '';
                await loadMoods();
            }
        }

        async function loadSleepData() {
            const sleepData = await fetchData('/api/sleep_tracker');
            const sleepListTbody = document.getElementById('sleep-list');
            sleepListTbody.innerHTML = '';
            if (sleepData && sleepData.length > 0) {
                sleepData.forEach(sleep => {
                    sleepListTbody.innerHTML += `
                        <tr>
                            <td>${sleep.sleep_date}</td>
                            <td>${sleep.hours_slept}</td>
                            <td>${sleep.quality_score}</td>
                        </tr>
                    `;
                });
            } else {
                sleepListTbody.innerHTML = `<tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No sleep entries yet.</td></tr>`;
            }
        }

        async function addSleep() {
            const sleepDate = document.getElementById('sleep-date').value;
            const hoursSlept = document.getElementById('hours-slept').value;
            const qualityScore = document.getElementById('sleep-quality').value;

            if (!sleepDate || !hoursSlept || !qualityScore) {
                showMessage('Please fill in all sleep details.', 'error');
                return;
            }

            const data = { sleep_date: sleepDate, hours_slept: parseFloat(hoursSlept), quality_score: parseInt(qualityScore) };
            const result = await postData('/api/sleep_tracker', data);
            if (result) {
                showMessage('Sleep entry added successfully!', 'success');
                document.getElementById('sleep-date').value = '';
                document.getElementById('hours-slept').value = '';
                document.getElementById('sleep-quality').value = '';
                await loadSleepData();
            }
        }

        // --- Pomodoro Timer Functions ---
        let workMinutesInput = document.getElementById('work-minutes');
        let breakMinutesInput = document.getElementById('break-minutes');
        let timerDisplay = document.getElementById('timer-display');
        let timerStatus = document.getElementById('timer-status');
        let timerBeep = document.getElementById('timer-beep');

        let intervalId;
        let isPaused = true;
        let isWorkPhase = true;
        let currentTime = 25 * 60; // Default work time in seconds

        function updateTimerDisplay() {
            const minutes = Math.floor(currentTime / 60);
            const seconds = currentTime % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        async function togglePhase() {
            isWorkPhase = !isWorkPhase;
            if (isWorkPhase) {
                currentTime = parseInt(workMinutesInput.value) * 60;
                timerStatus.textContent = "Work Time!";
            } else {
                // Before starting break, record the work session
                const sessionDate = new Date().toISOString().split('T')[0];
                const duration = parseInt(workMinutesInput.value);
                await postData('/api/pomodoro_sessions', {
                    session_date: sessionDate,
                    duration_minutes: duration,
                    is_work_session: true
                });
                await loadProgressCharts(); // Refresh chart after recording session
                await loadTodaySummary(); // Update summary if pomodoro hours are included
                await loadCompletedToday(); // Update completed section

                currentTime = parseInt(breakMinutesInput.value) * 60;
                timerStatus.textContent = "Break Time!";
            }
            timerBeep.play(); // Play sound when phase changes
            updateTimerDisplay();
        }

        function startTimer() {
            if (!isPaused) return; // Already running
            isPaused = false;
            intervalId = setInterval(() => {
                if (currentTime <= 0) {
                    clearInterval(intervalId);
                    togglePhase();
                    startTimer(); // Auto-start next phase
                } else {
                    currentTime--;
                    updateTimerDisplay();
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(intervalId);
            isPaused = true;
        }

        function resetTimer() {
            clearInterval(intervalId);
            isPaused = true;
            isWorkPhase = true;
            currentTime = parseInt(workMinutesInput.value) * 60;
            timerStatus.textContent = "Work Time!";
            updateTimerDisplay();
        }

        // Initialize timer display on load
        document.addEventListener('DOMContentLoaded', () => {
            updateTimerDisplay();
            workMinutesInput.addEventListener('change', resetTimer);
            breakMinutesInput.addEventListener('change', resetTimer);
        });


        // --- Medical Student Hub Functions ---
        async function loadStudyPlans() {
            const plans = await fetchData('/api/study_plans');
            const studyPlanListTbody = document.getElementById('study-plan-list');
            studyPlanListTbody.innerHTML = '';
            if (plans && plans.length > 0) {
                plans.forEach(plan => {
                    const statusClass = plan.is_completed ? 'status-completed' : 'status-pending';
                    const statusText = plan.is_completed ? 'Completed' : 'NEEDED TO BE COMPLETED';
                    studyPlanListTbody.innerHTML += `
                        <tr>
                            <td>${plan.day_of_week}</td>
                            <td>${plan.time_slot}</td>
                            <td>${plan.topic}</td>
                            <td>${plan.resource_type}</td>
                            <td class="${statusClass}">
                                <input type="checkbox" ${plan.is_completed ? 'checked' : ''} onchange="toggleStudyPlanCompletion(${plan.id}, this.checked)">
                                ${plan.is_completed ? '✅' : '⏳'} ${statusText}
                            </td>
                            <td><button onclick="deleteStudyPlan(${plan.id})" class="delete-btn text-white text-xs px-3 py-1 rounded-md">Delete</button></td>
                        </tr>
                    `;
                });
            } else {
                studyPlanListTbody.innerHTML = `<tr><td colspan="6" class="text-center text-gray-500 dark:text-gray-400 py-4">No study plans yet.</td></tr>`;
            }
        }

        async function addStudyPlan() {
            const day = document.getElementById('study-day').value;
            const time = document.getElementById('study-time').value;
            const topic = document.getElementById('study-topic').value;
            const resource = document.getElementById('study-resource').value;

            if (!day || !time || !topic || !resource) {
                showMessage('Please fill in all study plan fields.', 'error');
                return;
            }

            const data = { day_of_week: day, time_slot: time, topic: topic, resource_type: resource, is_completed: false };
            const result = await postData('/api/study_plans', data);
            if (result) {
                showMessage('Study plan added successfully!', 'success');
                document.getElementById('study-day').value = '';
                document.getElementById('study-time').value = '';
                document.getElementById('study-topic').value = '';
                document.getElementById('study-resource').value = '';
                await loadStudyPlans();
                await loadTodaySummary(); // Update summary if new plans affect it
            }
        }

        async function toggleStudyPlanCompletion(id, isCompleted) {
            const result = await putData(`/api/study_plans/${id}`, { is_completed: isCompleted, completion_date: isCompleted ? new Date().toISOString().split('T')[0] : null });
            if (result) {
                showMessage(`Study plan marked as ${isCompleted ? 'completed' : 'pending'}!`, 'success');
                await loadStudyPlans();
                await loadTodaySummary(); // Update summary if completion affects it
                await loadCompletedToday(); // Update completed section
            }
        }

        async function deleteStudyPlan(id) {
            const result = await deleteData(`/api/study_plans/${id}`);
            if (result) {
                showMessage('Study plan deleted successfully!', 'success');
                await loadStudyPlans();
                await loadTodaySummary(); // Update summary if deletion affects it
            }
        }

        async function loadSubjects() {
            const subjects = await fetchData('/api/subjects');
            const subjectsListTbody = document.getElementById('subjects-list');
            subjectsListTbody.innerHTML = '';
            if (subjects && subjects.length > 0) {
                subjects.forEach(subject => {
                    subjectsListTbody.innerHTML += `
                        <tr>
                            <td>${subject.subject_name}</td>
                            <td>${subject.completed_lectures || 0}</td>
                            <td>${subject.total_lectures || 'N/A'}</td>
                            <td>${subject.description || 'N/A'}</td>
                            <td>
                                <button onclick="completeLecture(${subject.id})" class="add-btn text-white text-xs px-3 py-1 rounded-md mr-1">Done Lecture</button>
                                <button onclick="addLecture(${subject.id})" class="bg-blue-500 hover:bg-blue-600 text-white text-xs px-3 py-1 rounded-md">New Lecture</button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                subjectsListTbody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 dark:text-gray-400 py-4">No subjects added yet.</td></tr>`;
            }
        }

        async function addSubject() {
            const name = document.getElementById('subject-name').value;
            const totalLectures = document.getElementById('subject-total-lectures').value;
            const description = document.getElementById('subject-description').value;

            if (!name) {
                showMessage('Please enter a subject name.', 'error');
                return;
            }

            const data = {
                subject_name: name,
                total_lectures: totalLectures ? parseInt(totalLectures) : 0,
                completed_lectures: 0,
                description: description
            };
            const result = await postData('/api/subjects', data);
            if (result) {
                showMessage('Subject added successfully!', 'success');
                document.getElementById('subject-name').value = '';
                document.getElementById('subject-total-lectures').value = '';
                document.getElementById('subject-description').value = '';
                await loadSubjects();
                await loadProgressCharts(); // Update chart on new subject (though counts are 0 initially)
                await loadTodaySummary(); // Update summary
            }
        }

        async function completeLecture(id) {
            const result = await putData(`/api/subjects/${id}/complete_lecture`);
            if (result) {
                showMessage('Lecture marked as complete!', 'success');
                await loadSubjects();
                await loadProgressCharts();
                await loadTodaySummary(); // Update summary
                await loadCompletedToday(); // Update completed section
                if (result.achievement_unlocked) {
                    showMessage(`Achievement Unlocked: ${result.achievement_description}!`, 'success');
                    await loadAchievements(); // Refresh achievements if a new one was added
                }
            }
        }

        async function addLecture(id) {
            const result = await putData(`/api/subjects/${id}/add_lecture`);
            if (result) {
                showMessage('New lecture added to subject!', 'success');
                await loadSubjects();
                await loadProgressCharts();
                await loadTodaySummary(); // Update summary
            }
        }

        async function loadReadWatchQueue() {
            const queueItems = await fetchData('/api/read_watch_queue');
            const readWatchListTbody = document.getElementById('read-watch-list');
            readWatchListTbody.innerHTML = '';
            if (queueItems && queueItems.length > 0) {
                queueItems.forEach(item => {
                    const statusClass = item.is_completed ? 'status-completed' : 'status-pending';
                    const statusText = item.is_completed ? 'Completed' : 'NEEDED TO BE COMPLETED';
                    readWatchListTbody.innerHTML += `
                        <tr class="${statusClass}">
                            <td>${item.title}</td>
                            <td>${item.type}</td>
                            <td><a href="${item.url}" target="_blank" class="text-blue-500 hover:underline dark:text-blue-300">Link</a></td>
                            <td>${item.is_completed ? '✅' : '⏳'} ${statusText}</td>
                        </tr>
                    `;
                });
            } else {
                readWatchListTbody.innerHTML = `<tr><td colspan="4" class="text-center text-gray-500 dark:text-gray-400 py-4">No items in queue yet.</td></tr>`;
            }
        }

        async function addReadWatchQueue() {
            const title = document.getElementById('queue-title').value;
            const type = document.getElementById('queue-type').value;
            const url = document.getElementById('queue-url').value;
            const isCompleted = document.getElementById('queue-completed').checked;

            if (!title || !type || !url) {
                showMessage('Please fill in all queue item fields.', 'error');
                return;
            }

            const data = { title: title, type: type, url: url, is_completed: isCompleted };
            const result = await postData('/api/read_watch_queue', data);
            if (result) {
                showMessage('Item added to queue successfully!', 'success');
                document.getElementById('queue-title').value = '';
                document.getElementById('queue-type').value = '';
                document.getElementById('queue-url').value = '';
                document.getElementById('queue-completed').checked = false;
                await loadReadWatchQueue();
            }
        }

        let studyProgressChartInstance = null;
        async function loadProgressCharts() {
            // Fetch aggregated data for the chart from a new API endpoint
            const chartData = await fetchData('/api/dashboard_summary_data');
            const ctx = document.getElementById('studyProgressChart').getContext('2d');
            const chartContainer = document.querySelector('.chart-container');

            // Clear any existing "no data" message
            const existingNoDataMessage = chartContainer.querySelector('.no-chart-data-message');
            if (existingNoDataMessage) {
                existingNoDataMessage.remove();
            }

            if (studyProgressChartInstance) {
                studyProgressChartInstance.destroy();
            }

            if (chartData && chartData.dates && chartData.dates.length > 0) {
                const labels = chartData.dates; // Assuming dates are provided by the backend
                const pomodoroHours = chartData.pomodoro_hours;
                const lecturesCompleted = chartData.lectures_completed;
                const manualStudyHours = chartData.manual_study_hours; // From progress_charts table

                studyProgressChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Pomodoro Hours',
                                data: pomodoroHours,
                                borderColor: 'rgb(255, 99, 132)', // Reddish
                                tension: 0.1,
                                fill: false,
                                pointBackgroundColor: 'rgb(255, 99, 132)',
                                pointBorderColor: '#fff',
                            },
                            {
                                label: 'Lectures Completed',
                                data: lecturesCompleted,
                                borderColor: 'rgb(54, 162, 235)', // Blueish
                                tension: 0.1,
                                fill: false,
                                pointBackgroundColor: 'rgb(54, 162, 235)',
                                pointBorderColor: '#fff',
                            },
                            {
                                label: 'Manual Study Hours',
                                data: manualStudyHours,
                                borderColor: 'rgb(75, 192, 192)', // Greenish
                                tension: 0.1,
                                fill: false,
                                pointBackgroundColor: 'rgb(75, 192, 192)',
                                pointBorderColor: '#fff',
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false, // Keep this false as height is set by container
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: htmlElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    color: htmlElement.classList.contains('dark') ? '#e2e8f0' : '#333'
                                }
                            },
                            x: {
                                grid: {
                                    color: htmlElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    color: htmlElement.classList.contains('dark') ? '#e2e8f0' : '#333'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: htmlElement.classList.contains('dark') ? '#e2e8f0' : '#333'
                                }
                            }
                        }
                    }
                });
            } else {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                const noDataMessage = document.createElement('p');
                noDataMessage.textContent = 'No chart data available yet.';
                noDataMessage.className = 'text-center text-gray-500 dark:text-gray-400 py-4 no-chart-data-message';
                chartContainer.appendChild(noDataMessage); // Append to the container
            }
        }

        async function addProgressChartData() {
            const weekStartDate = document.getElementById('chart-week-start-date').value;
            const hoursStudied = document.getElementById('chart-hours-studied').value;
            const topicsCovered = document.getElementById('chart-topics-covered').value;

            if (!weekStartDate || !hoursStudied || !topicsCovered) {
                showMessage('Please fill in all progress chart fields.', 'error');
                return;
            }

            const data = { week_start_date: weekStartDate, hours_studied: parseFloat(hoursStudied), topics_covered: topicsCovered };
            const result = await postData('/api/progress_charts', data);
            if (result) {
                showMessage('Progress data added successfully!', 'success');
                document.getElementById('chart-week-start-date').value = '';
                document.getElementById('chart-hours-studied').value = '';
                document.getElementById('chart-topics-covered').value = '';
                await loadProgressCharts();
            }
        }

        // --- Fitness & Gym Tracker Functions ---
        async function loadWorkouts() {
            const workouts = await fetchData('/api/workouts');
            const workoutListTbody = document.getElementById('workout-list');
            workoutListTbody.innerHTML = '';
            if (workouts && workouts.length > 0) {
                workouts.forEach(workout => {
                    const statusClass = workout.is_completed ? 'status-completed' : 'status-pending';
                    const statusText = workout.is_completed ? 'Completed' : 'NEEDED TO BE COMPLETED';
                    workoutListTbody.innerHTML += `
                        <tr>
                            <td>${workout.workout_date}</td>
                            <td>${workout.split_type}</td>
                            <td>${workout.exercise_name}</td>
                            <td>${workout.sets}</td>
                            <td>${workout.reps}</td>
                            <td>${workout.weight}</td>
                            <td>${workout.muscle_soreness || 'N/A'}</td>
                            <td>${workout.notes || 'N/A'}</td>
                            <td class="${statusClass}">
                                <input type="checkbox" ${workout.is_completed ? 'checked' : ''} onchange="toggleWorkoutCompletion(${workout.id}, this.checked)">
                                ${workout.is_completed ? '✅' : '⏳'} ${statusText}
                            </td>
                        </tr>
                    `;
                });
            } else {
                workoutListTbody.innerHTML = `<tr><td colspan="9" class="text-center text-gray-500 dark:text-gray-400 py-4">No workouts recorded yet.</td></tr>`;
            }
        }

        async function addWorkout() {
            const workoutDate = document.getElementById('workout-date').value;
            const splitType = document.getElementById('workout-split').value;
            const exerciseName = document.getElementById('exercise-name').value;
            const sets = document.getElementById('exercise-sets').value;
            const reps = document.getElementById('exercise-reps').value;
            const weight = document.getElementById('exercise-weight').value;
            const muscleSoreness = document.getElementById('muscle-soreness').value;
            const notes = document.getElementById('workout-notes').value;

            if (!workoutDate || !splitType || !exerciseName || !sets || !reps || !weight) {
                showMessage('Please fill in all required workout fields.', 'error');
                return;
            }

            const data = {
                workout_date: workoutDate,
                split_type: splitType,
                exercise_name: exerciseName,
                sets: parseInt(sets),
                reps: parseInt(reps),
                weight: parseFloat(weight),
                muscle_soreness: muscleSoreness ? parseInt(muscleSoreness) : null,
                notes: notes,
                is_completed: false // Default to not completed
            };
            const result = await postData('/api/workouts', data);
            if (result) {
                showMessage('Workout added successfully!', 'success');
                document.getElementById('workout-date').value = '';
                document.getElementById('workout-split').value = '';
                document.getElementById('exercise-name').value = '';
                document.getElementById('exercise-sets').value = '';
                document.getElementById('exercise-reps').value = '';
                document.getElementById('exercise-weight').value = '';
                document.getElementById('muscle-soreness').value = '';
                document.getElementById('workout-notes').value = '';
                await loadWorkouts();
                await loadTodaySummary(); // Update summary
            }
        }

        async function toggleWorkoutCompletion(id, isCompleted) {
            const result = await putData(`/api/workouts/${id}`, { is_completed: isCompleted });
            if (result) {
                showMessage(`Workout marked as ${isCompleted ? 'completed' : 'pending'}!`, 'success');
                await loadWorkouts();
                await loadTodaySummary(); // Update summary
                await loadCompletedToday(); // Update completed section
            }
        }

        async function loadBodyProgress() {
            const progress = await fetchData('/api/body_progress');
            const bodyProgressListTbody = document.getElementById('body-progress-list');
            bodyProgressListTbody.innerHTML = '';
            if (progress && progress.length > 0) {
                progress.forEach(item => {
                    const measurementsText = item.measurements ? JSON.stringify(item.measurements) : 'N/A';
                    bodyProgressListTbody.innerHTML += `
                        <tr>
                            <td>${item.record_date}</td>
                            <td>${item.weight}</td>
                            <td>${measurementsText}</td>
                            <td>${item.goal || 'N/A'}</td>
                            <td>${item.photo_url ? `<a href="${item.photo_url}" target="_blank" class="text-blue-500 hover:underline dark:text-blue-300">View</a>` : 'N/A'}</td>
                        </tr>
                    `;
                });
            } else {
                bodyProgressListTbody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 dark:text-gray-400 py-4">No body progress recorded yet.</td></tr>`;
            }
        }

        async function addBodyProgress() {
            const recordDate = document.getElementById('body-record-date').value;
            const weight = document.getElementById('body-weight').value;
            const photoUrl = document.getElementById('body-photo-url').value;
            const measurements = document.getElementById('body-measurements').value;
            const goal = document.getElementById('body-goal').value;

            if (!recordDate || !weight) {
                showMessage('Please fill in record date and weight.', 'error');
                return;
            }

            let parsedMeasurements = null;
            if (measurements) {
                try {
                    parsedMeasurements = JSON.parse(measurements);
                } catch (e) {
                    showMessage('Invalid JSON for measurements.', 'error');
                    return;
                }
            }

            const data = {
                record_date: recordDate,
                weight: parseFloat(weight),
                photo_url: photoUrl,
                measurements: parsedMeasurements, // Send as object, Flask will stringify
                goal: goal
            };
            const result = await postData('/api/body_progress', data);
            if (result) {
                showMessage('Body progress added successfully!', 'success');
                document.getElementById('body-record-date').value = '';
                document.getElementById('body-weight').value = '';
                document.getElementById('body-photo-url').value = '';
                document.getElementById('body-measurements').value = '';
                document.getElementById('body-goal').value = '';
                await loadBodyProgress();
            }
        }

        async function loadNutrition() {
            const nutritionData = await fetchData('/api/nutrition');
            const nutritionListTbody = document.getElementById('nutrition-list');
            nutritionListTbody.innerHTML = '';
            if (nutritionData && nutritionData.length > 0) {
                nutritionData.forEach(meal => {
                    nutritionListTbody.innerHTML += `
                        <tr>
                            <td>${meal.meal_date}</td>
                            <td>${meal.meal_type}</td>
                            <td>${meal.meal_description}</td>
                            <td>${meal.calories}</td>
                            <td>${meal.protein_intake}</td>
                        </tr>
                    `;
                });
            } else {
                nutritionListTbody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 dark:text-gray-400 py-4">No nutrition entries yet.</td></tr>`;
            }
        }

        async function addNutrition() {
            const mealDate = document.getElementById('meal-date').value;
            const mealType = document.getElementById('meal-type').value;
            const mealDescription = document.getElementById('meal-description').value;
            const calories = document.getElementById('meal-calories').value;
            const protein = document.getElementById('meal-protein').value;

            if (!mealDate || !mealType || !mealDescription || !calories || !protein) {
                showMessage('Please fill in all nutrition fields.', 'error');
                return;
            }

            const data = {
                meal_date: mealDate,
                meal_type: mealType,
                meal_description: mealDescription,
                calories: parseInt(calories),
                protein_intake: parseFloat(protein)
            };
            const result = await postData('/api/nutrition', data);
            if (result) {
                showMessage('Nutrition entry added successfully!', 'success');
                document.getElementById('meal-date').value = '';
                document.getElementById('meal-type').value = '';
                document.getElementById('meal-description').value = '';
                document.getElementById('meal-calories').value = '';
                document.getElementById('meal-protein').value = '';
                await loadNutrition();
            }
        }

        async function loadShoppingList() {
            const shoppingItems = await fetchData('/api/shopping_list');
            const shoppingListItemsTbody = document.getElementById('shopping-list-items');
            shoppingListItemsTbody.innerHTML = '';
            if (shoppingItems && shoppingItems.length > 0) {
                shoppingItems.forEach(item => {
                    const completedClass = item.is_purchased ? 'completed-item' : '';
                    shoppingListItemsTbody.innerHTML += `
                        <tr class="${completedClass}">
                            <td>${item.item_name}</td>
                            <td>${item.quantity || 'N/A'}</td>
                            <td>${item.is_purchased ? '✅ Purchased' : '🛒 Pending'}</td>
                        </tr>
                    `;
                });
            } else {
                shoppingListItemsTbody.innerHTML = `<tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No shopping items yet.</td></tr>`;
            }
        }

        async function addShoppingItem() {
            const itemName = document.getElementById('shopping-item-name').value;
            const quantity = document.getElementById('shopping-item-quantity').value;
            const isPurchased = document.getElementById('shopping-item-purchased').checked;

            if (!itemName) {
                showMessage('Please enter an item name.', 'error');
                return;
            }

            const data = { item_name: itemName, quantity: quantity, is_purchased: isPurchased };
            const result = await postData('/api/shopping_list', data);
            if (result) {
                showMessage('Item added to shopping list successfully!', 'success');
                document.getElementById('shopping-item-name').value = '';
                document.getElementById('shopping-item-quantity').value = '';
                document.getElementById('shopping-item-purchased').checked = false;
                await loadShoppingList();
            }
        }

        // --- Basketball & Analysis Lab Functions ---
        async function loadGameClips() {
            const clips = await fetchData('/api/game_clips');
            const gameClipsListTbody = document.getElementById('game-clips-list');
            gameClipsListTbody.innerHTML = '';
            if (clips && clips.length > 0) {
                clips.forEach(clip => {
                    const annotationsText = clip.annotations ? JSON.stringify(clip.annotations) : 'N/A';
                    gameClipsListTbody.innerHTML += `
                        <tr>
                            <td>${clip.clip_title}</td>
                            <td>${clip.upload_date}</td>
                            <td>${annotationsText}</td>
                            <td><a href="${clip.video_url}" target="_blank" class="text-blue-500 hover:underline dark:text-blue-300">Watch Clip</a></td>
                        </tr>
                    `;
                });
            } else {
                gameClipsListTbody.innerHTML = `<tr><td colspan="4" class="text-center text-gray-500 dark:text-gray-400 py-4">No game clips added yet.</td></tr>`;
            }
        }

        async function addGameClip() {
            const clipTitle = document.getElementById('clip-title').value;
            const videoUrl = document.getElementById('clip-video-url').value;
            const annotations = document.getElementById('clip-annotations').value;

            if (!clipTitle || !videoUrl) {
                showMessage('Please fill in clip title and video URL.', 'error');
                return;
            }

            let parsedAnnotations = null;
            if (annotations) {
                try {
                    parsedAnnotations = JSON.parse(annotations);
                } catch (e) {
                    showMessage('Invalid JSON for annotations.', 'error');
                    return;
                }
            }

            const data = { clip_title: clipTitle, video_url: videoUrl, annotations: parsedAnnotations };
            const result = await postData('/api/game_clips', data);
            if (result) {
                showMessage('Game clip added successfully!', 'success');
                document.getElementById('clip-title').value = '';
                document.getElementById('clip-video-url').value = '';
                document.getElementById('clip-annotations').value = '';
                await loadGameClips();
            }
        }

        async function loadScoutingTemplates() {
            const templates = await fetchData('/api/scouting_templates');
            const scoutingTemplatesListTbody = document.getElementById('scouting-templates-list');
            scoutingTemplatesListTbody.innerHTML = '';
            if (templates && templates.length > 0) {
                templates.forEach(template => {
                    scoutingTemplatesListTbody.innerHTML += `
                        <tr>
                            <td>${template.template_name}</td>
                            <td>${template.opponent_name || 'N/A'}</td>
                            <td>${template.report_content || 'N/A'}</td>
                        </tr>
                    `;
                });
            } else {
                scoutingTemplatesListTbody.innerHTML = `<tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No scouting templates added yet.</td></tr>`;
            }
        }

        async function addScoutingTemplate() {
            const templateName = document.getElementById('template-name').value;
            const opponentName = document.getElementById('opponent-name').value;
            const reportContent = document.getElementById('report-content').value;

            if (!templateName) {
                showMessage('Please enter a template name.', 'error');
                return;
            }

            const data = { template_name: templateName, opponent_name: opponentName, report_content: reportContent };
            const result = await postData('/api/scouting_templates', data);
            if (result) {
                showMessage('Scouting template added successfully!', 'success');
                document.getElementById('template-name').value = '';
                document.getElementById('opponent-name').value = '';
                document.getElementById('report-content').value = '';
                await loadScoutingTemplates();
            }
        }

        async function loadLearningResources() {
            const resources = await fetchData('/api/learning_resources');
            const learningResourcesListTbody = document.getElementById('learning-resources-list');
            learningResourcesListTbody.innerHTML = '';
            if (resources && resources.length > 0) {
                resources.forEach(resource => {
                    learningResourcesListTbody.innerHTML += `
                        <tr>
                            <td>${resource.resource_title}</td>
                            <td>${resource.platform || 'N/A'}</td>
                            <td><a href="${resource.url}" target="_blank" class="text-blue-500 hover:underline dark:text-blue-300">Link</a></td>
                        </tr>
                    `;
                });
            } else {
                learningResourcesListTbody.innerHTML = `<tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No learning resources added yet.</td></tr>`;
            }
        }

        async function addLearningResource() {
            const resourceTitle = document.getElementById('resource-title').value;
            const platform = document.getElementById('resource-platform').value;
            const url = document.getElementById('resource-url').value;

            if (!resourceTitle || !url) {
                showMessage('Please fill in resource title and URL.', 'error');
                return;
            }

            const data = { resource_title: resourceTitle, platform: platform, url: url };
            const result = await postData('/api/learning_resources', data);
            if (result) {
                showMessage('Learning resource added successfully!', 'success');
                document.getElementById('resource-title').value = '';
                document.getElementById('resource-platform').value = '';
                document.getElementById('resource-url').value = '';
                await loadLearningResources();
            }
        }

        // --- Self-Development & Courses Functions ---
        async function loadCourses() {
            const courses = await fetchData('/api/courses');
            const coursesListTbody = document.getElementById('courses-list');
            coursesListTbody.innerHTML = '';
            if (courses && courses.length > 0) {
                courses.forEach(course => {
                    coursesListTbody.innerHTML += `
                        <tr>
                            <td>${course.course_name}</td>
                            <td>${course.status}</td>
                            <td>${course.start_date || 'N/A'}</td>
                            <td>${course.completion_date || 'N/A'}</td>
                        </tr>
                    `;
                });
            } else {
                coursesListTbody.innerHTML = `<tr><td colspan="4" class="text-center text-gray-500 dark:text-gray-400 py-4">No courses added yet.</td></tr>`;
            }
        }

        async function addCourse() {
            const courseName = document.getElementById('course-name').value;
            const status = document.getElementById('course-status').value;
            const startDate = document.getElementById('course-start-date').value;
            const completionDate = document.getElementById('course-completion-date').value;

            if (!courseName || !status) {
                showMessage('Please fill in course name and status.', 'error');
                return;
            }

            const data = {
                course_name: courseName,
                status: status,
                start_date: startDate || null,
                completion_date: completionDate || null
            };
            const result = await postData('/api/courses', data);
            if (result) {
                showMessage('Course added successfully!', 'success');
                document.getElementById('course-name').value = '';
                document.getElementById('course-status').value = '';
                document.getElementById('course-start-date').value = '';
                document.getElementById('course-completion-date').value = '';
                await loadCourses();
            }
        }

        async function loadSkillGoals() {
            const goals = await fetchData('/api/skill_goals');
            const skillGoalsListTbody = document.getElementById('skill-goals-list');
            skillGoalsListTbody.innerHTML = '';
            if (goals && goals.length > 0) {
                goals.forEach(goal => {
                    const achievedClass = goal.is_achieved ? 'completed-item' : '';
                    skillGoalsListTbody.innerHTML += `
                        <tr class="${achievedClass}">
                            <td>${goal.skill_name}</td>
                            <td>${goal.target_date || 'N/A'}</td>
                            <td>${goal.is_achieved ? '🏆 Achieved' : '🎯 Pending'}</td>
                        </tr>
                    `;
                });
            } else {
                skillGoalsListTbody.innerHTML = `<tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No skill goals added yet.</td></tr>`;
            }
        }

        async function addSkillGoal() {
            const skillName = document.getElementById('skill-name').value;
            const targetDate = document.getElementById('skill-target-date').value;
            const isAchieved = document.getElementById('skill-achieved').checked;

            if (!skillName) {
                showMessage('Please enter a skill name.', 'error');
                return;
            }

            const data = { skill_name: skillName, target_date: targetDate || null, is_achieved: isAchieved };
            const result = await postData('/api/skill_goals', data);
            if (result) {
                showMessage('Skill goal added successfully!', 'success');
                document.getElementById('skill-name').value = '';
                document.getElementById('skill-target-date').value = '';
                document.getElementById('skill-achieved').checked = false;
                await loadSkillGoals();
            }
        }

        // --- Streaks & Checkpoints Section Functions ---
        async function loadAchievements() {
            const achievements = await fetchData('/api/achievements');
            const achievementsListTbody = document.getElementById('achievements-list');
            achievementsListTbody.innerHTML = '';
            if (achievements && achievements.length > 0) {
                achievements.forEach(achievement => {
                    achievementsListTbody.innerHTML += `
                        <tr>
                            <td>${achievement.achievement_date}</td>
                            <td>${achievement.description}</td>
                        </tr>
                    `;
                });
            } else {
                achievementsListTbody.innerHTML = `<tr><td colspan="2" class="text-center text-gray-500 dark:text-gray-400 py-4">No achievements yet.</td></tr>`;
            }
        }
        async function addAchievement() {
            const achievementDate = document.getElementById('achievement-date').value;
            const description = document.getElementById('achievement-description').value;

            if (!achievementDate || !description) {
                showMessage('Please fill in achievement date and description.', 'error');
                return;
            }

            const data = { achievement_date: achievementDate, description: description };
            const result = await postData('/api/achievements', data);
            if (result) {
                showMessage('Achievement added successfully!', 'success');
                document.getElementById('achievement-date').value = '';
                document.getElementById('achievement-description').value = '';
                await loadAchievements();
            }
        }

        async function loadDailySchedule() {
            const schedule = await fetchData('/api/daily_schedule');
            const dailyScheduleListTbody = document.getElementById('daily-schedule-list');
            dailyScheduleListTbody.innerHTML = '';
            if (schedule && schedule.length > 0) {
                schedule.forEach(entry => {
                    const completedClass = entry.morning_routine_completed ? 'completed-item' : '';
                    dailyScheduleListTbody.innerHTML += `
                        <tr class="${completedClass}">
                            <td>${entry.schedule_date}</td>
                            <td>${entry.morning_routine_completed ? '✅ Completed' : '⏰ Pending'}</td>
                        </tr>
                    `;
                });
            } else {
                dailyScheduleListTbody.innerHTML = `<tr><td colspan="2" class="text-center text-gray-500 dark:text-gray-400 py-4">No daily schedule entries yet.</td></tr>`;
            }
        }

        async function addDailySchedule() {
            const scheduleDate = document.getElementById('schedule-date').value;
            const morningRoutineCompleted = document.getElementById('morning-routine-completed').checked;

            if (!scheduleDate) {
                showMessage('Please select a schedule date.', 'error');
                return;
            }

            const data = { schedule_date: scheduleDate, morning_routine_completed: morningRoutineCompleted };
            const result = await postData('/api/daily_schedule', data);
            if (result) {
                showMessage('Daily schedule entry added successfully!', 'success');
                document.getElementById('schedule-date').value = '';
                document.getElementById('morning-routine-completed').checked = false;
                await loadDailySchedule();
            }
        }

        async function loadTimeBlocking() {
            const blocks = await fetchData('/api/time_blocking');
            const timeBlockingListTbody = document.getElementById('time-blocking-list');
            timeBlockingListTbody.innerHTML = '';
            if (blocks && blocks.length > 0) {
                blocks.forEach(block => {
                    timeBlockingListTbody.innerHTML += `
                        <tr>
                            <td>${block.schedule_date}</td>
                            <td>${block.time_slot}</td>
                            <td>${block.activity}</td>
                        </tr>
                    `;
                });
            } else {
                timeBlockingListTbody.innerHTML = `<tr><td colspan="3" class="text-center text-gray-500 dark:text-gray-400 py-4">No time blocks added yet.</td></tr>`;
            }
        }

        async function addTimeBlock() {
            const scheduleDate = document.getElementById('time-block-date').value;
            const timeSlot = document.getElementById('time-block-slot').value;
            const activity = document.getElementById('time-block-activity').value;

            if (!scheduleDate || !timeSlot || !activity) {
                showMessage('Please fill in all time block fields.', 'error');
                return;
            }

            const data = { schedule_date: scheduleDate, time_slot: timeSlot, activity: activity };
            const result = await postData('/api/time_blocking', data);
            if (result) {
                showMessage('Time block added successfully!', 'success');
                document.getElementById('time-block-date').value = '';
                document.getElementById('time-block-slot').value = '';
                document.getElementById('time-block-activity').value = '';
                await loadTimeBlocking();
            }
        }

        async function loadConsistencyScore() {
            const scores = await fetchData('/api/consistency_score');
            const consistencyScoreListTbody = document.getElementById('consistency-score-list');
            consistencyScoreListTbody.innerHTML = '';
            if (scores && scores.length > 0) {
                scores.forEach(score => {
                    consistencyScoreListTbody.innerHTML += `
                        <tr>
                            <td>${score.record_date}</td>
                            <td>${score.sleep_score}</td>
                            <td>${score.gym_score}</td>
                            <td>${score.study_score}</td>
                        </tr>
                    `;
                });
            } else {
                consistencyScoreListTbody.innerHTML = `<tr><td colspan="4" class="text-center text-gray-500 dark:text-gray-400 py-4">No consistency scores yet.</td></tr>`;
            }
        }

        async function addConsistencyScore() {
            const recordDate = document.getElementById('consistency-date').value;
            const sleepScore = document.getElementById('consistency-sleep').value;
            const gymScore = document.getElementById('consistency-gym').value;
            const studyScore = document.getElementById('consistency-study').value;

            if (!recordDate || !sleepScore || !gymScore || !studyScore) {
                showMessage('Please fill in all consistency score fields.', 'error');
                return;
            }

            const data = {
                record_date: recordDate,
                sleep_score: parseInt(sleepScore),
                gym_score: parseInt(gymScore),
                study_score: parseInt(studyScore)
            };
            const result = await postData('/api/consistency_score', data);
            if (result) {
                showMessage('Consistency score added successfully!', 'success');
                document.getElementById('consistency-date').value = '';
                document.getElementById('consistency-sleep').value = '';
                document.getElementById('consistency-gym').value = '';
                document.getElementById('consistency-study').value = '';
                await loadConsistencyScore();
            }
        }

    </script>
</body>
</html>
